// =============================================================================
// BERK Hardware Bridge - Robot Kol KontrolÃ¼
// 4 eksenli servo tabanlÄ± robot kol Ã¶rneÄŸi
// =============================================================================

kullan std::firmata
kullan std::math
kullan std::time

yazdÄ±r("=== 4-Eksen Robot Kol KontrolÃ¼ ===\n")

// -----------------------------------------------------------------------------
// YapÄ±landÄ±rma
// -----------------------------------------------------------------------------

sabit PORT = "COM3"

// Servo pinleri
sabit PIN_TABAN = 9      // Taban dÃ¶nÃ¼ÅŸÃ¼ (0-180Â°)
sabit PIN_OMUZ = 10      // Omuz eklemi (0-180Â°)
sabit PIN_DIRSEK = 11    // Dirsek eklemi (0-180Â°)
sabit PIN_TUTUCU = 6     // Tutucu (0: aÃ§Ä±k, 45: kapalÄ±)

// Servo limitleri
sabit MIN_PULSE = 544    // Minimum pulse (Âµs)
sabit MAX_PULSE = 2400   // Maximum pulse (Âµs)

// Hareket hÄ±zÄ±
sabit HAREKET_GECIKMESI = 20  // ms (kÃ¼Ã§Ã¼k = hÄ±zlÄ±)

// -----------------------------------------------------------------------------
// YardÄ±mcÄ± Fonksiyonlar
// -----------------------------------------------------------------------------

// YumuÅŸak hareket (bir aÃ§Ä±dan diÄŸerine yavaÅŸÃ§a geÃ§)
fonksiyon yumusak_hareket(arduino, pin, baslangic, bitis) yap
    olsun adim = eÄŸer baslangic < bitis ise 1 deÄŸilse -1 son
    
    dÃ¶ngÃ¼ aci = baslangic iken aci != bitis yap
        firmata::servo_write(arduino, pin, aci)
        bekle(HAREKET_GECIKMESI)
        aci = aci + adim
    son
    
    firmata::servo_write(arduino, pin, bitis)
son

// TÃ¼m eklemleri aynÄ± anda hareket ettir
fonksiyon hareket_et(arduino, taban, omuz, dirsek) yap
    firmata::servo_write(arduino, PIN_TABAN, taban)
    firmata::servo_write(arduino, PIN_OMUZ, omuz)
    firmata::servo_write(arduino, PIN_DIRSEK, dirsek)
    bekle(500)
son

// Tutucuyu kontrol et
fonksiyon tutucu_ac(arduino) yap
    firmata::servo_write(arduino, PIN_TUTUCU, 0)
    yazdÄ±r("   âœ‹ Tutucu AÃ‡IK")
    bekle(300)
son

fonksiyon tutucu_kapat(arduino) yap
    firmata::servo_write(arduino, PIN_TUTUCU, 45)
    yazdÄ±r("   âœŠ Tutucu KAPALI")
    bekle(300)
son

// BaÅŸlangÄ±Ã§ pozisyonu
fonksiyon baslangic_pozisyonu(arduino) yap
    yazdÄ±r("ğŸ  BaÅŸlangÄ±Ã§ pozisyonuna dÃ¶nÃ¼lÃ¼yor...")
    hareket_et(arduino, 90, 90, 90)
    tutucu_ac(arduino)
    yazdÄ±r("   âœ“ HazÄ±r")
son

// -----------------------------------------------------------------------------
// Hareket SekanslarÄ±
// -----------------------------------------------------------------------------

fonksiyon pick_and_place(arduino, kaynak_aci, hedef_aci) yap
    yazdÄ±r("\nğŸ“¦ Pick & Place iÅŸlemi:")
    yazdÄ±r("   Kaynak: {}Â°, Hedef: {}Â°", kaynak_aci, hedef_aci)
    
    // KaynaÄŸa git
    yazdÄ±r("   â†’ KaynaÄŸa gidiliyor...")
    hareket_et(arduino, kaynak_aci, 60, 120)  // AlÃ§al
    bekle(300)
    
    // Nesneyi al
    tutucu_kapat(arduino)
    bekle(200)
    
    // KaldÄ±r
    hareket_et(arduino, kaynak_aci, 90, 90)
    yazdÄ±r("   â†‘ Nesne alÄ±ndÄ±")
    
    // Hedefe git
    yazdÄ±r("   â†’ Hedefe gidiliyor...")
    hareket_et(arduino, hedef_aci, 90, 90)
    bekle(300)
    
    // Ä°ndir
    hareket_et(arduino, hedef_aci, 60, 120)
    
    // BÄ±rak
    tutucu_ac(arduino)
    yazdÄ±r("   â†“ Nesne bÄ±rakÄ±ldÄ±")
    
    // Geri Ã§ekil
    hareket_et(arduino, hedef_aci, 90, 90)
    yazdÄ±r("   âœ“ Ä°ÅŸlem tamamlandÄ±")
son

fonksiyon dalga_hareketi(arduino) yap
    yazdÄ±r("\nğŸ‘‹ Dalga hareketi...")
    
    // Kolu kaldÄ±r
    hareket_et(arduino, 90, 45, 45)
    
    // SaÄŸa-sola salla
    dÃ¶ngÃ¼ _ iÃ§in 0..3 yap
        yumusak_hareket(arduino, PIN_TABAN, 90, 120)
        yumusak_hareket(arduino, PIN_TABAN, 120, 60)
        yumusak_hareket(arduino, PIN_TABAN, 60, 90)
    son
    
    yazdÄ±r("   âœ“ Dalga tamamlandÄ±")
son

fonksiyon tarama_hareketi(arduino) yap
    yazdÄ±r("\nğŸ” 360Â° tarama...")
    
    // Kolu kaldÄ±r
    hareket_et(arduino, 0, 70, 70)
    
    // Tam tur
    dÃ¶ngÃ¼ aci iÃ§in 0..181 adÄ±m 10 yap
        firmata::servo_write(arduino, PIN_TABAN, aci)
        yazdÄ±r("   AÃ§Ä±: {}Â°", aci)
        bekle(100)
    son
    
    // Geri dÃ¶n
    yumusak_hareket(arduino, PIN_TABAN, 180, 90)
    yazdÄ±r("   âœ“ Tarama tamamlandÄ±")
son

// -----------------------------------------------------------------------------
// Ana Program
// -----------------------------------------------------------------------------

yazdÄ±r("ğŸ¤– Robot Kol KontrolÃ¼ BaÅŸlatÄ±lÄ±yor...")
yazdÄ±r("-" * 40)
yazdÄ±r("Pin YapÄ±landÄ±rmasÄ±:")
yazdÄ±r("  Taban:   Pin {}", PIN_TABAN)
yazdÄ±r("  Omuz:    Pin {}", PIN_OMUZ)
yazdÄ±r("  Dirsek:  Pin {}", PIN_DIRSEK)
yazdÄ±r("  Tutucu:  Pin {}", PIN_TUTUCU)
yazdÄ±r("")

dene yap
    // BaÄŸlan
    yazdÄ±r("ğŸ”Œ Arduino'ya baÄŸlanÄ±lÄ±yor ({})...", PORT)
    olsun arduino = firmata::connect(PORT)
    yazdÄ±r("âœ“ BaÄŸlantÄ± baÅŸarÄ±lÄ±!")
    
    // Arduino hazÄ±rlanmasÄ± iÃ§in bekle
    bekle(2000)
    
    // Servo pinlerini yapÄ±landÄ±r
    yazdÄ±r("\nâš™ï¸  Servolar yapÄ±landÄ±rÄ±lÄ±yor...")
    firmata::servo_config(arduino, PIN_TABAN, MIN_PULSE, MAX_PULSE)
    firmata::servo_config(arduino, PIN_OMUZ, MIN_PULSE, MAX_PULSE)
    firmata::servo_config(arduino, PIN_DIRSEK, MIN_PULSE, MAX_PULSE)
    firmata::servo_config(arduino, PIN_TUTUCU, MIN_PULSE, MAX_PULSE)
    yazdÄ±r("âœ“ Servolar hazÄ±r")
    
    // BaÅŸlangÄ±Ã§ pozisyonu
    baslangic_pozisyonu(arduino)
    bekle(1000)
    
    // Demo sekansÄ±
    yazdÄ±r("\n" + "=" * 40)
    yazdÄ±r("        DEMO SEKANS BAÅLIYOR")
    yazdÄ±r("=" * 40)
    
    // 1. Pick & Place
    pick_and_place(arduino, 45, 135)
    bekle(500)
    
    // 2. BaÅŸlangÄ±ca dÃ¶n
    baslangic_pozisyonu(arduino)
    bekle(500)
    
    // 3. Dalga hareketi
    dalga_hareketi(arduino)
    bekle(500)
    
    // 4. Tarama
    tarama_hareketi(arduino)
    bekle(500)
    
    // Bitir
    baslangic_pozisyonu(arduino)
    
    // BaÄŸlantÄ±yÄ± kapat
    yazdÄ±r("\nğŸ”Œ BaÄŸlantÄ± kapatÄ±lÄ±yor...")
    firmata::disconnect(arduino)
    
    yazdÄ±r("")
    yazdÄ±r("=" * 40)
    yazdÄ±r("âœ… DEMO BAÅARIYLA TAMAMLANDI!")
    yazdÄ±r("=" * 40)
    
yakala hata yap
    yazdÄ±r("\nâŒ HATA: {}", hata)
    yazdÄ±r("")
    yazdÄ±r("Kontrol edin:")
    yazdÄ±r("  1. Arduino baÄŸlÄ± ve StandardFirmata yÃ¼klÃ¼ mÃ¼?")
    yazdÄ±r("  2. Servo baÄŸlantÄ±larÄ± doÄŸru mu?")
    yazdÄ±r("  3. Harici gÃ¼Ã§ kaynaÄŸÄ± baÄŸlÄ± mÄ±? (Servolara)")
son
