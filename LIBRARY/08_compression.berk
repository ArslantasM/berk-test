// =============================================================================
// BERK Standard Library - Compression Module Demo
// Veri sÄ±kÄ±ÅŸtÄ±rma iÅŸlemleri
// =============================================================================

kullan std::compression
kullan std::fs

yazdÄ±r("=== BERK Compression Demo ===\n")

// -----------------------------------------------------------------------------
// Gzip SÄ±kÄ±ÅŸtÄ±rma
// -----------------------------------------------------------------------------

yazdÄ±r("ğŸ—œï¸  Gzip SÄ±kÄ±ÅŸtÄ±rma:")
yazdÄ±r("-" * 40)

olsun metin = "Bu metin sÄ±kÄ±ÅŸtÄ±rÄ±lacak. " * 100
yazdÄ±r("Orijinal boyut: {} byte", metin.uzunluk())

// SÄ±kÄ±ÅŸtÄ±r
olsun sikistirilmis = compression::gzip_compress(metin)
yazdÄ±r("SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ: {} byte", sikistirilmis.uzunluk())
yazdÄ±r("Oran: %{:.1f}", (1.0 - sikistirilmis.uzunluk() / metin.uzunluk()) * 100)

// AÃ§
olsun acilmis = compression::gzip_decompress(sikistirilmis)
yazdÄ±r("AÃ§Ä±lmÄ±ÅŸ: {} byte", acilmis.uzunluk())
yazdÄ±r("EÅŸleÅŸme: {}", metin == acilmis)

// -----------------------------------------------------------------------------
// Zlib SÄ±kÄ±ÅŸtÄ±rma
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸ“¦ Zlib SÄ±kÄ±ÅŸtÄ±rma:")
yazdÄ±r("-" * 40)

// FarklÄ± sÄ±kÄ±ÅŸtÄ±rma seviyeleri
dÃ¶ngÃ¼ seviye iÃ§in [1, 6, 9] yap
    olsun zlib_sikis = compression::zlib_compress(metin, seviye)
    yazdÄ±r("Seviye {}: {} byte", seviye, zlib_sikis.uzunluk())
son

// -----------------------------------------------------------------------------
// Deflate
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸ’¨ Deflate SÄ±kÄ±ÅŸtÄ±rma:")
yazdÄ±r("-" * 40)

olsun deflate_sikis = compression::deflate(metin)
yazdÄ±r("Deflate: {} byte", deflate_sikis.uzunluk())

olsun inflate_acik = compression::inflate(deflate_sikis)
yazdÄ±r("Inflate: {} byte", inflate_acik.uzunluk())

// -----------------------------------------------------------------------------
// ZIP ArÅŸivleme
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸ“ ZIP ArÅŸivleme:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
// ZIP oluÅŸtur
olsun zip = compression::zip_create("arsiv.zip")

// Dosya ekle
compression::zip_add_file(zip, "dosya1.txt", "Ä°Ã§erik 1")
compression::zip_add_file(zip, "klasor/dosya2.txt", "Ä°Ã§erik 2")

// Mevcut dosyayÄ± ekle
compression::zip_add_from_disk(zip, "belgeler/rapor.pdf")

// Kapat
compression::zip_close(zip)
""")

yazdÄ±r("""
// ZIP aÃ§
olsun zip = compression::zip_open("arsiv.zip")

// DosyalarÄ± listele
olsun dosyalar = compression::zip_list(zip)
her dosya iÃ§in dosyalar yap
    yazdÄ±r("  {}: {} byte", dosya.name, dosya.size)
son

// Dosya Ã§Ä±kar
olsun icerik = compression::zip_extract(zip, "dosya1.txt")
yazdÄ±r("Ä°Ã§erik: {}", icerik)

// TÃ¼mÃ¼nÃ¼ Ã§Ä±kar
compression::zip_extract_all(zip, "./cikti/")

compression::zip_close(zip)
""")

// -----------------------------------------------------------------------------
// Byte Dizisi SÄ±kÄ±ÅŸtÄ±rma
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸ”¢ Binary Veri SÄ±kÄ±ÅŸtÄ±rma:")
yazdÄ±r("-" * 40)

olsun binary_veri = [0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF] * 50
yazdÄ±r("Binary veri: {} byte", binary_veri.uzunluk())

olsun sikis = compression::compress_bytes(binary_veri, "gzip")
yazdÄ±r("SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ: {} byte", sikis.uzunluk())

// -----------------------------------------------------------------------------
// AkÄ±ÅŸ SÄ±kÄ±ÅŸtÄ±rma
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸŒŠ AkÄ±ÅŸ SÄ±kÄ±ÅŸtÄ±rma (Streaming):")
yazdÄ±r("-" * 40)

yazdÄ±r("""
// BÃ¼yÃ¼k dosyalarÄ± akÄ±ÅŸ olarak sÄ±kÄ±ÅŸtÄ±r
olsun encoder = compression::create_encoder("gzip", 6)

olsun dosya = fs::open("buyuk_dosya.bin", "rb")
olsun cikti = fs::create("buyuk_dosya.bin.gz")

dÃ¶ngÃ¼ yap
    olsun chunk = fs::read_bytes(dosya, 4096)
    eÄŸer chunk.uzunluk() == 0 ise dur son
    
    olsun sikis_chunk = compression::encode_chunk(encoder, chunk)
    fs::write_bytes(cikti, sikis_chunk)
son

// Son bloÄŸu yaz
olsun son_blok = compression::finish_encode(encoder)
fs::write_bytes(cikti, son_blok)

fs::close(dosya)
fs::close(cikti)
""")

yazdÄ±r("\nâœ… Compression demo tamamlandÄ±!")
