// =============================================================================
// BERK Standard Library - Testing Module Demo
// Unit test ve assertion framework
// =============================================================================

kullan std::testing

yazdÄ±r("=== BERK Testing Demo ===\n")

// -----------------------------------------------------------------------------
// Test ModÃ¼lÃ¼ YapÄ±sÄ±
// -----------------------------------------------------------------------------

yazdÄ±r("ğŸ§ª Test YapÄ±sÄ±:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
kullan std::testing

// Test modÃ¼lÃ¼ tanÄ±mla
test_modul "Math Testleri" yap
    
    test "toplama doÄŸru Ã§alÄ±ÅŸmalÄ±" yap
        testing::assert_eq(2 + 2, 4)
        testing::assert_eq(0 + 0, 0)
        testing::assert_eq(-1 + 1, 0)
    son
    
    test "Ã§arpma doÄŸru Ã§alÄ±ÅŸmalÄ±" yap
        testing::assert_eq(3 * 4, 12)
        testing::assert_eq(0 * 100, 0)
    son
    
    test "bÃ¶lme doÄŸru Ã§alÄ±ÅŸmalÄ±" yap
        testing::assert_eq(10 / 2, 5)
        testing::assert_float_eq(7.0 / 2.0, 3.5, 0.001)
    son
    
son
""")

// -----------------------------------------------------------------------------
// Assertion TÃ¼rleri
// -----------------------------------------------------------------------------

yazdÄ±r("\nâœ… Assertion TÃ¼rleri:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
// EÅŸitlik
testing::assert_eq(gerÃ§ek, beklenen)
testing::assert_ne(a, b)  // eÅŸit deÄŸil

// Boolean
testing::assert_true(koÅŸul)
testing::assert_false(koÅŸul)

// Null kontrolÃ¼
testing::assert_null(deÄŸer)
testing::assert_not_null(deÄŸer)

// Float karÅŸÄ±laÅŸtÄ±rma (tolerans ile)
testing::assert_float_eq(3.14159, 3.14, 0.01)

// String iÃ§erir
testing::assert_contains("Merhaba DÃ¼nya", "DÃ¼nya")
testing::assert_starts_with("BERK", "BE")
testing::assert_ends_with("test.berk", ".berk")

// Array/List
testing::assert_len([1, 2, 3], 3)
testing::assert_empty([])
testing::assert_not_empty([1, 2])
testing::assert_contains_item([1, 2, 3], 2)

// SÄ±ralama
testing::assert_gt(5, 3)    // 5 > 3
testing::assert_gte(5, 5)   // 5 >= 5
testing::assert_lt(3, 5)    // 3 < 5
testing::assert_lte(3, 3)   // 3 <= 3

// Range
testing::assert_in_range(5, 1, 10)

// Type kontrolÃ¼
testing::assert_type(deÄŸer, "string")
""")

// -----------------------------------------------------------------------------
// Exception Testleri
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸ’¥ Exception Testleri:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
test "sÄ±fÄ±ra bÃ¶lme hata vermeli" yap
    testing::assert_throws(fonksiyon() yap
        olsun x = 10 / 0
    son)
son

test "geÃ§ersiz index hata vermeli" yap
    testing::assert_throws_type(fonksiyon() yap
        olsun arr = [1, 2, 3]
        olsun x = arr[10]
    son, "IndexOutOfBounds")
son

test "hata mesajÄ±nÄ± kontrol et" yap
    testing::assert_throws_message(fonksiyon() yap
        panic("Ã–zel hata mesajÄ±")
    son, "Ã–zel hata")
son
""")

// -----------------------------------------------------------------------------
// Test Fixture (Setup/Teardown)
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸ”§ Test Fixture:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
test_modul "Database Testleri" yap
    
    olsun db = boÅŸ
    
    setup yap
        // Her testten Ã¶nce Ã§alÄ±ÅŸÄ±r
        db = database::connect("test.db")
        database::execute(db, "CREATE TABLE users (id INT, name TEXT)")
    son
    
    teardown yap
        // Her testten sonra Ã§alÄ±ÅŸÄ±r
        database::execute(db, "DROP TABLE users")
        database::close(db)
    son
    
    test "kullanÄ±cÄ± ekle" yap
        database::execute(db, "INSERT INTO users VALUES (1, 'Test')")
        olsun sayÄ± = database::query_one(db, "SELECT COUNT(*) FROM users")
        testing::assert_eq(sayÄ±, 1)
    son
    
    test "kullanÄ±cÄ± sil" yap
        database::execute(db, "INSERT INTO users VALUES (1, 'Test')")
        database::execute(db, "DELETE FROM users WHERE id = 1")
        olsun sayÄ± = database::query_one(db, "SELECT COUNT(*) FROM users")
        testing::assert_eq(sayÄ±, 0)
    son
    
son
""")

// -----------------------------------------------------------------------------
// Parametreli Testler
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸ“‹ Parametreli Testler:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
test_parametreli "fibonacci hesaplama" [
    [0, 0],
    [1, 1],
    [2, 1],
    [5, 5],
    [10, 55]
] yap |n, beklenen|
    olsun sonuc = fibonacci(n)
    testing::assert_eq(sonuc, beklenen)
son

test_parametreli "string uzunluk" [
    ["", 0],
    ["a", 1],
    ["merhaba", 7],
    ["BERK dili", 9]
] yap |metin, beklenen|
    testing::assert_eq(metin.uzunluk(), beklenen)
son
""")

// -----------------------------------------------------------------------------
// Mock ve Stub
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸ­ Mock ve Stub:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
test "API Ã§aÄŸrÄ±sÄ± mock ile" yap
    // Mock oluÅŸtur
    olsun mock_api = testing::mock("http::get")
    
    // Beklenen davranÄ±ÅŸÄ± tanÄ±mla
    testing::when(mock_api)
        .called_with("https://api.example.com/data")
        .returns({"status": 200, "data": "test"})
    
    // Test et
    olsun sonuc = fetch_data()
    testing::assert_eq(sonuc.data, "test")
    
    // DoÄŸrula
    testing::verify(mock_api).was_called_once()
son

test "spy ile Ã§aÄŸrÄ± izleme" yap
    olsun spy = testing::spy(logger::log)
    
    // Fonksiyonu Ã§aÄŸÄ±r
    do_something()
    
    // Kontrol et
    testing::assert_true(spy.was_called())
    testing::assert_eq(spy.call_count(), 3)
    testing::assert_eq(spy.last_call_args()[0], "Ä°ÅŸlem tamamlandÄ±")
son
""")

// -----------------------------------------------------------------------------
// Benchmark Testleri
// -----------------------------------------------------------------------------

yazdÄ±r("\nâ±ï¸  Benchmark Testleri:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
benchmark "sÄ±ralama performansÄ±" yap
    olsun arr = testing::random_array(10000)
    
    testing::measure(fonksiyon() yap
        quick_sort(arr.clone())
    son)
son

benchmark "string birleÅŸtirme" iterations: 1000 yap
    olsun s = ""
    dÃ¶ngÃ¼ _ iÃ§in 0..100 yap
        s = s + "x"
    son
son

// Benchmark sonuÃ§larÄ±
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ Benchmark                   â”‚ Ortalama â”‚ Std Dev  â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ sÄ±ralama performansÄ±        â”‚ 12.5 ms  â”‚ 0.8 ms   â”‚
// â”‚ string birleÅŸtirme          â”‚ 0.15 ms  â”‚ 0.02 ms  â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
""")

// -----------------------------------------------------------------------------
// Test Ã‡alÄ±ÅŸtÄ±rma
// -----------------------------------------------------------------------------

yazdÄ±r("\nğŸš€ Test Ã‡alÄ±ÅŸtÄ±rma:")
yazdÄ±r("-" * 40)

yazdÄ±r("""
# TÃ¼m testleri Ã§alÄ±ÅŸtÄ±r
berk test

# Belirli modÃ¼lÃ¼ test et
berk test math_tests

# Belirli testi Ã§alÄ±ÅŸtÄ±r
berk test --filter "toplama"

# Verbose Ã§Ä±ktÄ±
berk test --verbose

# Coverage raporu
berk test --coverage

# Paralel Ã§alÄ±ÅŸtÄ±rma
berk test --parallel 4

# JUnit XML Ã§Ä±ktÄ±sÄ±
berk test --output junit.xml
""")

yazdÄ±r("""
Test SonuÃ§ Ã‡Ä±ktÄ±sÄ±:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§ª Math Testleri
  âœ… toplama doÄŸru Ã§alÄ±ÅŸmalÄ± (0.2 ms)
  âœ… Ã§arpma doÄŸru Ã§alÄ±ÅŸmalÄ± (0.1 ms)
  âœ… bÃ¶lme doÄŸru Ã§alÄ±ÅŸmalÄ± (0.3 ms)

ğŸ§ª String Testleri
  âœ… uzunluk kontrolÃ¼ (0.1 ms)
  âŒ boÅŸ string kontrolÃ¼ (0.1 ms)
     Expected: 0, Got: 1
     at tests/string_test.berk:15

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SonuÃ§: 4 passed, 1 failed, 0 skipped
SÃ¼re: 0.8 ms
Coverage: 85%
""")

yazdÄ±r("\nâœ… Testing demo tamamlandÄ±!")
